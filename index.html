<!doctype html> 
<html> 
<head> 
    <meta http-equiv="content-type" content="text/html; charset=utf-8" /> 
    <meta name="keywords" content="天地图山东" /> 
    <title>天地图－地图API－范例－WMS-C图层加载</title> 
    <script src="http://www.sdmap.gov.cn/api/olapi/js/jquery-1.6.4.min.js"></script> 
    <!--[if lt IE 9]> 
    <script src="http://www.sdmap.gov.cn/api/olapi/js/html5.js"></script> 
    <![endif]--> 
    <script type="text/javascript" src="http://www.sdmap.gov.cn/api/olapi/ol/openlayers.js"></script> 
  <style type="text/css"> 
body{width: 100%;height: 100%;position: absolute;margin: 0;} 
#outter{height: 100%} 
#mapDiv{height: 100%;width: 100%} 
#reback{position: absolute;bottom: 10px;right: 100px;z-index: 1002;} 
#reback a{background-color: #7D7D7D; padding: 10px;color: #FFF;} 
.pic {width: 1760px;height: 480px}
</style> 
<script type="text/javascript" id="codetoshow"> 
    //定义地图对象 
    var map; 
    var sdannoLayer = new SDRSAnnoLayer();
    var sdimgLayer = new SDRasterLayer(); 
    $(function () { 
        map = new OpenLayers.Map("mapDiv", { 
            allOverlays: true, 
            numZoomLevels: 19, 
            displayProjection: "EPSG:4490", 
            controls: [ 
            new OpenLayers.Control.Navigation(),
            new OpenLayers.Control.Zoom(), 
            new OpenLayers.Control.ArgParser(), 
            new OpenLayers.Control.Attribution()] 
        }); 
        map.addLayer(sdimgLayer); 
        map.addLayer(sdannoLayer); ;
        map.setCenter(new OpenLayers.LonLat(117.93341, 37.67119), 16); 
        //添加矢量图层
        var graphicLayer = new OpenLayers.Layer.Vector("graphicLayer",
            { style: OpenLayers.Util.extend({}, OpenLayers.Feature.Vector.style['default']) });
        map.addLayer(graphicLayer);
        var coordinates = [
            {lon: 117.92207,lat: 37.66459},
            {lon: 117.92381,lat: 37.66487},
            {lon: 117.92499,lat: 37.66493},
            {lon: 117.92624,lat: 37.66517},
            {lon: 117.92748,lat: 37.66530},
            {lon: 117.92877,lat: 37.66547},
            {lon: 117.92997,lat: 37.66564},
            {lon: 117.93128,lat: 37.66581},
            {lon: 117.93248,lat: 37.66598},
            {lon: 117.93377,lat: 37.66613},
            {lon: 117.93516,lat: 37.66628},
            {lon: 117.93600,lat: 37.66633},
            {lon: 117.93735,lat: 37.66637},
            {lon: 117.93872,lat: 37.66654},
            {lon: 117.94010,lat: 37.66675},
            {lon: 117.94130,lat: 37.66680},
            {lon: 117.94259,lat: 37.66690},
            {lon: 117.94383,lat: 37.66706},
            {lon: 117.94508,lat: 37.66699},

            // 泵房坐标
            {lon: 117.93403,lat: 37.66537},
            {lon: 117.93506,lat: 37.66555},
        ];
        var shuibiaoStyle = {
            externalGraphic: 'img/shuibiao.png', 
            graphicWidth: 30, 
            graphicHeight: 30
        }; 
        var bengfangStyle = {
            externalGraphic: 'img/bengfang.png', 
            graphicWidth: 50, 
            graphicHeight: 21 
        }; 
        for(var i = 0; i < 19; i++) {
            var pt = new OpenLayers.Geometry.Point(coordinates[i].lon, coordinates[i].lat); 
            var feature = new OpenLayers.Feature.Vector(pt, {i}, shuibiaoStyle);
            graphicLayer.addFeatures([feature]);
        }
        for(var i = 19; i < 21; i++) {
            var pt = new OpenLayers.Geometry.Point(coordinates[i].lon, coordinates[i].lat); 
            var feature = new OpenLayers.Feature.Vector(pt, {i}, bengfangStyle);
            graphicLayer.addFeatures([feature]);
        }

        //坐标转换  
        function corTransform(lon, lat) {  
            var proj = new OpenLayers.Projection("EPSG:4326");  
            var lonlat = new OpenLayers.LonLat(lon, lat);  
            lonlat.transform(proj, this.map.getProjectionObject());  
            return lonlat;   
        }

        // 水表点击事件注册
        var selectControl = new OpenLayers.Control.SelectFeature([graphicLayer]);
        map.addControl(selectControl); 
        selectControl.activate(); 
        function featureSelected(fea) {
            var feature = fea.feature;
            console.log(feature);
            var dom = "<div><div style='width: 200px;padding: 0 15px'>"
            +"<div><h4>详细信息</h4></div>"
            +"<p>信息1</p>"
            +"<p>信息2</p>"
            +"<p>信息3</p>"
            +"<p>信息4</p>"
            +"<p>信息5</p>"
            +"</div></div>";
            var popup = new OpenLayers.Popup.FramedCloud("xx", 
                new OpenLayers.LonLat(feature.geometry.x, feature.geometry.y),
                null, dom, null, true);
            map.addPopup(popup, true);
            console.log(popup);
            selectControl.unselectAll(); 
        }
        graphicLayer.events.on({ "featureselected": featureSelected }); 
        
        map.events.register('click', null, function (e) {          
            var pos = $(map.div).offset();
            //坐标转换
            var px = new OpenLayers.Pixel(e.clientX - pos.left, e.clientY - pos.top);
            var lonlat = map.getLonLatFromPixel(px);
            alert(lonlat.lon.toFixed(5) + ";" + lonlat.lat.toFixed(5));
        })
        
        $(document).keydown(function(event){
            if(event.keyCode == 81)
                $('#pic').toggle();            
        });
    }); 
</script> 
</head> 
<body> 
    <div id="outter"> 
        <div id="mapDiv"> 
        </div> 
    </div>
    <img id="pic" style="position:absolute;left:-200px;top:0;z-index:999999" class="pic" src="img/cad.png"/>
</body> 
</html> 
