<!doctype html> 
<html> 
<head> 
    <meta http-equiv="content-type" content="text/html; charset=utf-8" /> 
    <meta name="keywords" content="天地图山东" /> 
    <title>天地图－地图API－范例－WMS-C图层加载</title> 
    <script src="http://www.sdmap.gov.cn/api/olapi/js/jquery-1.6.4.min.js"></script> 
    <!--[if lt IE 9]> 
    <script src="http://www.sdmap.gov.cn/api/olapi/js/html5.js"></script> 
    <![endif]--> 
    <script type="text/javascript" src="http://www.sdmap.gov.cn/api/olapi/ol/openlayers.js"></script> 
  <style type="text/css"> 
body{width: 100%;height: 100%;position: absolute;margin: 0;} 
#outter{height: 100%} 
#mapDiv{height: 100%;width: 100%} 
#reback{position: absolute;bottom: 10px;right: 100px;z-index: 1002;} 
#reback a{background-color: #7D7D7D; padding: 10px;color: #FFF;} 
</style> 
<script type="text/javascript" id="codetoshow"> 
    //定义地图对象 
    var map; 
    var sdannoLayer = new SDRSAnnoLayer();
    var sdimgLayer = new SDRasterLayer(); 
    $(function () { 
        map = new OpenLayers.Map("mapDiv", { 
            allOverlays: true, 
            numZoomLevels: 19, 
            displayProjection: "EPSG:4490", 
            controls: [ 
            new OpenLayers.Control.Navigation(),
                            new OpenLayers.Control.Zoom(), 
            new OpenLayers.Control.ArgParser(), 
            new OpenLayers.Control.Attribution()] 
        }); 
        map.addLayer(sdimgLayer); 
        map.addLayer(sdannoLayer); 
        map.setCenter(new OpenLayers.LonLat(117.946004, 37.68969), 17); 
        //添加矢量图层
        var graphicLayer = new OpenLayers.Layer.Vector("graphicLayer",
            { style: OpenLayers.Util.extend({}, OpenLayers.Feature.Vector.style['default']) }); 
        map.addLayer(graphicLayer); 
        var pt = new OpenLayers.Geometry.Point(117.946004, 37.68969); 
        var style = {
            externalGraphic: 'img/pin.png', 
            graphicWidth: 60, 
            graphicHeight: 60 
        }; 
        var feature = new OpenLayers.Feature.Vector(pt, null, style); 
        graphicLayer.addFeatures([feature]); 
        //坐标转换  
        function corTransform(lon, lat) {  
            var proj = new OpenLayers.Projection("EPSG:4326");  
            var lonlat = new OpenLayers.LonLat(lon, lat);  
            lonlat.transform(proj, this.map.getProjectionObject());  
            return lonlat;   
        }
        map.events.register('click', null, function (e) {          
            var pos = $(map.div).offset();
            //坐标转换
            var px = new OpenLayers.Pixel(e.clientX - pos.left, e.clientY - pos.top);
            var lonlat = map.getLonLatFromPixel(px);
            alert(lonlat.lon.toFixed(5) + ";" + lonlat.lat.toFixed(5));
        })
    }); 
</script> 
</head> 
<body> 
    <div id="outter"> 
        <div id="mapDiv"> 
        </div> 
    </div>
</body> 
</html> 
